#!/bin/bash

# stopped containers
echo y | docker container prune --filter label!=persistent

# old tagged images
for image in $(docker images --format "{{.Repository}}" --filter reference="awerlang/*" | sort -u); do
    for tag in $(docker images --format '{{.Tag}}' "$image" | awk '$1~/latest/ {next} get == 1 { print $1 } get != 1 { get=1 }'); do 
        docker rmi --no-prune "$image:$tag";
    done
done

# dangling images
echo y | docker image prune

echo y | docker volume prune
